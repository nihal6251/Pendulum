/*!
 * @pixi/canvas-graphics - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/canvas-graphics is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */
import{ExtensionType as e,Texture as t,RenderTexture as i}from"@pixi/core";import{Matrix as r,SHAPES as a}from"@pixi/math";import{canvasUtils as o,CanvasRenderer as n}from"@pixi/canvas-renderer";import{Graphics as l}from"@pixi/graphics";var s,h=function(){function e(){}return e.offsetPolygon=function(t,i){var r=[],a=t.length;i=e.isPolygonClockwise(t)?i:-1*i;for(var o=0;o<a;o+=2){var n=o-2;n<0&&(n+=a);var l=(o+2)%a,s=t[o]-t[n],h=t[o+1]-t[n+1],v=Math.sqrt(s*s+h*h);s/=v,h/=v;var g=-(h*=i),p=s*=i,f=[t[n]+g,t[n+1]+p],c=[t[o]+g,t[o+1]+p],u=t[l]-t[o],d=t[l+1]-t[o+1];u/=v=Math.sqrt(u*u+d*d),d/=v;var m=-(d*=i),T=u*=i,y=[t[o]+m,t[o+1]+T],x=[t[l]+m,t[l+1]+T],b=e.findIntersection(f[0],f[1],c[0],c[1],y[0],y[1],x[0],x[1]);b&&r.push.apply(r,b)}return r},e.findIntersection=function(e,t,i,r,a,o,n,l){var s=(l-o)*(i-e)-(n-a)*(r-t),h=(n-a)*(t-o)-(l-o)*(e-a);if(0===s)return 0===h&&0===(i-e)*(t-o)-(r-t)*(e-a)?[(e+i)/2,(t+r)/2]:null;var v=h/s;return[e+v*(i-e),t+v*(r-t)]},e.isPolygonClockwise=function(e){for(var t=0,i=0,r=e.length-2;i<e.length;r=i,i+=2)t+=(e[i]-e[r])*(e[i+1]+e[r+1]);return t>0},e}(),v=function(){function i(e){this._svgMatrix=null,this._tempMatrix=new r,this.renderer=e}return i.prototype._calcCanvasStyle=function(e,i){var a;return e.texture&&e.texture.baseTexture!==t.WHITE.baseTexture?e.texture.valid?(a=o.getTintedPattern(e.texture,i),this.setPatternTransform(a,e.matrix||r.IDENTITY)):a="#808080":a="#"+("00000"+(0|i).toString(16)).slice(-6),a},i.prototype.render=function(e){var t=this.renderer,i=t.context,r=e.worldAlpha,o=e.transform.worldTransform;t.setContextTransform(o),t.setBlendMode(e.blendMode);for(var n,l,s=e.geometry.graphicsData,h=(e.tint>>16&255)/255,v=(e.tint>>8&255)/255,g=(255&e.tint)/255,p=0;p<s.length;p++){var f=s[p],c=f.shape,u=f.fillStyle,d=f.lineStyle,m=0|f.fillStyle.color,T=0|f.lineStyle.color;if(f.matrix&&t.setContextTransform(o.copyTo(this._tempMatrix).append(f.matrix)),u.visible){var y=((m>>16&255)/255*h*255<<16)+((m>>8&255)/255*v*255<<8)+(255&m)/255*g*255;n=this._calcCanvasStyle(u,y)}if(d.visible){var x=((T>>16&255)/255*h*255<<16)+((T>>8&255)/255*v*255<<8)+(255&T)/255*g*255;l=this._calcCanvasStyle(d,x)}if(i.lineWidth=d.width,i.lineCap=d.cap,i.lineJoin=d.join,i.miterLimit=d.miterLimit,f.type===a.POLY){i.beginPath();var b=(A=c).points,P=f.holes,M=void 0,C=void 0,S=void 0,w=void 0,_=void 0;i.moveTo(b[0],b[1]);for(var k=2;k<b.length;k+=2)i.lineTo(b[k],b[k+1]);if(A.closeStroke&&i.closePath(),P.length>0){_=[],M=0,S=b[0],w=b[1];for(k=2;k+2<b.length;k+=2)M+=(b[k]-S)*(b[k+3]-w)-(b[k+2]-S)*(b[k+1]-w);for(var R=0;R<P.length;R++)if(b=P[R].shape.points){C=0,S=b[0],w=b[1];for(k=2;k+2<b.length;k+=2)C+=(b[k]-S)*(b[k+3]-w)-(b[k+2]-S)*(b[k+1]-w);if(C*M<0){i.moveTo(b[0],b[1]);for(k=2;k<b.length;k+=2)i.lineTo(b[k],b[k+1])}else{i.moveTo(b[b.length-2],b[b.length-1]);for(k=b.length-4;k>=0;k-=2)i.lineTo(b[k],b[k+1])}P[R].shape.closeStroke&&i.closePath(),_[R]=C*M<0}}u.visible&&(i.globalAlpha=u.alpha*r,i.fillStyle=n,i.fill()),d.visible&&this.paintPolygonStroke(A,d,l,P,_,r,i)}else if(f.type===a.RECT){var A=c;if(u.visible&&(i.globalAlpha=u.alpha*r,i.fillStyle=n,i.fillRect(A.x,A.y,A.width,A.height)),d.visible){var q=d.width*(.5-(1-d.alignment)),E=A.width+2*q,I=A.height+2*q;i.globalAlpha=d.alpha*r,i.strokeStyle=l,i.strokeRect(A.x-q,A.y-q,E,I)}}else if(f.type===a.CIRC){A=c;if(i.beginPath(),i.arc(A.x,A.y,A.radius,0,2*Math.PI),i.closePath(),u.visible&&(i.globalAlpha=u.alpha*r,i.fillStyle=n,i.fill()),d.visible){if(.5!==d.alignment){q=d.width*(.5-(1-d.alignment));i.beginPath(),i.arc(A.x,A.y,A.radius+q,0,2*Math.PI),i.closePath()}i.globalAlpha=d.alpha*r,i.strokeStyle=l,i.stroke()}}else if(f.type===a.ELIP){A=c;if((J=1===d.alignment)||this.paintEllipse(A,u,d,n,r,i),d.visible){if(.5!==d.alignment){var z=.5522848,L=(q=d.width*(.5-(1-d.alignment)),2*(A.width+q)),D=2*(A.height+q),G=A.x-L/2,B=A.y-D/2,N=L/2*z,V=D/2*z,W=G+L,Y=B+D,j=G+L/2,H=B+D/2;i.beginPath(),i.moveTo(G,H),i.bezierCurveTo(G,H-V,j-N,B,j,B),i.bezierCurveTo(j+N,B,W,H-V,W,H),i.bezierCurveTo(W,H+V,j+N,Y,j,Y),i.bezierCurveTo(j-N,Y,G,H+V,G,H),i.closePath()}i.globalAlpha=d.alpha*r,i.strokeStyle=l,i.stroke()}J&&this.paintEllipse(A,u,d,n,r,i)}else if(f.type===a.RREC){var J;A=c;if((J=1===d.alignment)||this.paintRoundedRectangle(A,u,d,n,r,i),d.visible){if(.5!==d.alignment){E=A.width,I=A.height,q=d.width*(.5-(1-d.alignment));var O=A.x-q,F=A.y-q,K=A.width+2*q,Q=A.height+2*q,U=q*(d.alignment>=1?Math.min(K/E,Q/I):Math.min(E/K,I/Q)),X=A.radius+U,Z=Math.min(K,Q)/2;X=X>Z?Z:X,i.beginPath(),i.moveTo(O,F+X),i.lineTo(O,F+Q-X),i.quadraticCurveTo(O,F+Q,O+X,F+Q),i.lineTo(O+K-X,F+Q),i.quadraticCurveTo(O+K,F+Q,O+K,F+Q-X),i.lineTo(O+K,F+X),i.quadraticCurveTo(O+K,F,O+K-X,F),i.lineTo(O+X,F),i.quadraticCurveTo(O,F,O,F+X),i.closePath()}i.globalAlpha=d.alpha*r,i.strokeStyle=l,i.stroke()}J&&this.paintRoundedRectangle(A,u,d,n,r,i)}}},i.prototype.paintPolygonStroke=function(e,t,i,r,a,o,n){if(.5!==t.alignment){var l=t.width*(.5-(1-t.alignment)),s=h.offsetPolygon(e.points,l),v=void 0;n.beginPath(),n.moveTo(s[0],s[1]);for(var g=2;g<s.length;g+=2)n.lineTo(s[g],s[g+1]);e.closeStroke&&n.closePath();for(var p=0;p<r.length;p++){if(v=r[p].shape.points,s=h.offsetPolygon(v,l),a[p]){n.moveTo(s[0],s[1]);for(g=2;g<s.length;g+=2)n.lineTo(s[g],s[g+1])}else{n.moveTo(s[s.length-2],s[s.length-1]);for(g=s.length-4;g>=0;g-=2)n.lineTo(s[g],s[g+1])}r[p].shape.closeStroke&&n.closePath()}}n.globalAlpha=t.alpha*o,n.strokeStyle=i,n.stroke()},i.prototype.paintEllipse=function(e,t,i,r,a,o){var n=2*e.width,l=2*e.height,s=e.x-n/2,h=e.y-l/2,v=.5522848,g=n/2*v,p=l/2*v,f=s+n,c=h+l,u=s+n/2,d=h+l/2;0===i.alignment&&o.save(),o.beginPath(),o.moveTo(s,d),o.bezierCurveTo(s,d-p,u-g,h,u,h),o.bezierCurveTo(u+g,h,f,d-p,f,d),o.bezierCurveTo(f,d+p,u+g,c,u,c),o.bezierCurveTo(u-g,c,s,d+p,s,d),o.closePath(),0===i.alignment&&o.clip(),t.visible&&(o.globalAlpha=t.alpha*a,o.fillStyle=r,o.fill()),0===i.alignment&&o.restore()},i.prototype.paintRoundedRectangle=function(e,t,i,r,a,o){var n=e.x,l=e.y,s=e.width,h=e.height,v=e.radius,g=Math.min(s,h)/2;v=v>g?g:v,0===i.alignment&&o.save(),o.beginPath(),o.moveTo(n,l+v),o.lineTo(n,l+h-v),o.quadraticCurveTo(n,l+h,n+v,l+h),o.lineTo(n+s-v,l+h),o.quadraticCurveTo(n+s,l+h,n+s,l+h-v),o.lineTo(n+s,l+v),o.quadraticCurveTo(n+s,l,n+s-v,l),o.lineTo(n+v,l),o.quadraticCurveTo(n,l,n,l+v),o.closePath(),0===i.alignment&&o.clip(),t.visible&&(o.globalAlpha=t.alpha*a,o.fillStyle=r,o.fill()),0===i.alignment&&o.restore()},i.prototype.setPatternTransform=function(e,t){if(!1!==this._svgMatrix){if(!this._svgMatrix){var i=document.createElementNS("http://www.w3.org/2000/svg","svg");if(i&&i.createSVGMatrix&&(this._svgMatrix=i.createSVGMatrix()),!this._svgMatrix||!e.setTransform)return void(this._svgMatrix=!1)}this._svgMatrix.a=t.a,this._svgMatrix.b=t.b,this._svgMatrix.c=t.c,this._svgMatrix.d=t.d,this._svgMatrix.e=t.tx,this._svgMatrix.f=t.ty,e.setTransform(this._svgMatrix.inverse())}},i.prototype.destroy=function(){this.renderer=null,this._svgMatrix=null,this._tempMatrix=null},i.extension={name:"graphics",type:e.CanvasRendererPlugin},i}(),g=new r;l.prototype.generateCanvasTexture=function(e,r){void 0===r&&(r=1);var a=this.getLocalBounds(),o=i.create({width:a.width,height:a.height,scaleMode:e,resolution:r});s||(s=new n),this.transform.updateLocalTransform(),this.transform.localTransform.copyTo(g),g.invert(),g.tx-=a.x,g.ty-=a.y,s.render(this,{renderTexture:o,clear:!0,transform:g});var l=t.from(o.baseTexture._canvasRenderTarget.canvas,{scaleMode:e});return l.baseTexture.setResolution(r),l},l.prototype.cachedGraphicsData=[],l.prototype._renderCanvas=function(e){!0!==this.isMask&&(this.finishPoly(),e.plugins.graphics.render(this))};export{v as CanvasGraphicsRenderer};
//# sourceMappingURL=canvas-graphics.min.mjs.map
