/*!
 * @pixi/canvas-mesh - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/canvas-mesh is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@pixi/core"),t=require("@pixi/constants"),r=require("@pixi/canvas-renderer"),a=require("@pixi/settings"),i=require("@pixi/mesh"),n=require("@pixi/mesh-extras"),s=function(){function a(e){this.renderer=e}return a.prototype.render=function(e){var r=this.renderer,a=e.worldTransform;r.context.globalAlpha=e.worldAlpha,r.setBlendMode(e.blendMode),r.setContextTransform(a,e.roundPixels),e.drawMode!==t.DRAW_MODES.TRIANGLES?this._renderTriangleMesh(e):this._renderTriangles(e)},a.prototype._renderTriangleMesh=function(e){for(var t=e.geometry.buffers[0].data.length,r=0;r<t-2;r++){var a=2*r;this._renderDrawTriangle(e,a,a+2,a+4)}},a.prototype._renderTriangles=function(e){for(var t=e.geometry.getIndex().data,r=t.length,a=0;a<r;a+=3){var i=2*t[a],n=2*t[a+1],s=2*t[a+2];this._renderDrawTriangle(e,i,n,s)}},a.prototype._renderDrawTriangle=function(t,a,i,n){var s=this.renderer.context,o=t.geometry.buffers[0].data,h=t.uvs,d=t.texture;if(d.valid){var l=16777215!==t.tint,c=d.baseTexture,u=c.width,v=c.height;l&&t._cachedTint!==t.tint&&(t._cachedTint=t.tint,t._cachedTexture=t._cachedTexture||new e.Texture(c),t._tintedCanvas=r.canvasUtils.getTintedCanvas({texture:t._cachedTexture},t.tint));var p=l?t._tintedCanvas:c.getDrawableSource(),g=h[a]*c.width,_=h[i]*c.width,f=h[n]*c.width,x=h[a+1]*c.height,m=h[i+1]*c.height,T=h[n+1]*c.height,y=o[a],M=o[i],C=o[n],w=o[a+1],P=o[i+1],b=o[n+1],S=t.canvasPadding/this.renderer.resolution;if(S>0){var A=t.worldTransform,D=A.a,U=A.b,q=A.c,N=A.d,I=(y+M+C)/3,R=(w+P+b)/3,B=y-I,E=w-R,H=D*B+q*E,V=U*B+N*E,F=Math.sqrt(H*H+V*V),G=1+S/F;y=I+B*G,w=R+E*G,H=D*(B=M-I)+q*(E=P-R),V=U*B+N*E,M=I+B*(G=1+S/(F=Math.sqrt(H*H+V*V))),P=R+E*G,H=D*(B=C-I)+q*(E=b-R),V=U*B+N*E,C=I+B*(G=1+S/(F=Math.sqrt(H*H+V*V))),b=R+E*G}s.save(),s.beginPath(),s.moveTo(y,w),s.lineTo(M,P),s.lineTo(C,b),s.closePath(),s.clip();var O=g*m+x*f+_*T-m*f-x*_-g*T,W=y*m+x*C+M*T-m*C-x*M-y*T,j=g*M+y*f+_*C-M*f-y*_-g*C,L=g*m*C+x*M*f+y*_*T-y*m*f-x*_*C-g*M*T,k=w*m+x*b+P*T-m*b-x*P-w*T,z=g*P+w*f+_*b-P*f-w*_-g*b,J=g*m*b+x*P*f+w*_*T-w*m*f-x*_*b-g*P*T;s.transform(W/O,k/O,j/O,z/O,L/O,J/O),s.drawImage(p,0,0,u*c.resolution,v*c.resolution,0,0,u,v),s.restore(),this.renderer.invalidateBlendMode()}},a.prototype.renderMeshFlat=function(e){var t=this.renderer.context,r=e.geometry.getBuffer("aVertexPosition").data,a=r.length/2;t.beginPath();for(var i=1;i<a-2;++i){var n=2*i,s=r[n],o=r[n+1],h=r[n+2],d=r[n+3],l=r[n+4],c=r[n+5];t.moveTo(s,o),t.lineTo(h,d),t.lineTo(l,c)}t.fillStyle="#FF0000",t.fill(),t.closePath()},a.prototype.destroy=function(){this.renderer=null},a.extension={name:"mesh",type:e.ExtensionType.CanvasRendererPlugin},a}();a.settings.MESH_CANVAS_PADDING=0,i.MeshMaterial.prototype._renderCanvas=function(e,t){e.plugins.mesh.render(t)},n.NineSlicePlane.prototype._cachedTint=16777215,n.NineSlicePlane.prototype._tintedCanvas=null,n.NineSlicePlane.prototype._canvasUvs=null,n.NineSlicePlane.prototype._renderCanvas=function(e){var t=e.context,a=this.worldTransform,i=16777215!==this.tint,n=this.texture;if(n.valid){i&&this._cachedTint!==this.tint&&(this._cachedTint=this.tint,this._tintedCanvas=r.canvasUtils.getTintedCanvas(this,this.tint));var s=i?this._tintedCanvas:n.baseTexture.getDrawableSource();this._canvasUvs||(this._canvasUvs=[0,0,0,0,0,0,0,0]);var o=this.vertices,h=this._canvasUvs,d=i?0:n.frame.x,l=i?0:n.frame.y,c=d+n.frame.width,u=l+n.frame.height;h[0]=d,h[1]=d+this._leftWidth,h[2]=c-this._rightWidth,h[3]=c,h[4]=l,h[5]=l+this._topHeight,h[6]=u-this._bottomHeight,h[7]=u;for(var v=0;v<8;v++)h[v]*=n.baseTexture.resolution;t.globalAlpha=this.worldAlpha,e.setBlendMode(this.blendMode),e.setContextTransform(a,this.roundPixels);for(var p=0;p<3;p++)for(var g=0;g<3;g++){var _=2*g+8*p,f=Math.max(1,h[g+1]-h[g]),x=Math.max(1,h[p+5]-h[p+4]),m=Math.max(1,o[_+10]-o[_]),T=Math.max(1,o[_+11]-o[_+1]);t.drawImage(s,h[g],h[p+4],f,x,o[_],o[_+1],m,T)}}};var o=!1;i.Mesh.prototype._cachedTint=16777215,i.Mesh.prototype._tintedCanvas=null,i.Mesh.prototype._cachedTexture=null,i.Mesh.prototype._renderCanvas=function(e){this.shader.uvMatrix&&(this.shader.uvMatrix.update(),this.calculateUvs()),this.material._renderCanvas?this.material._renderCanvas(e,this):o||(o=!0,globalThis.console&&console.warn("Mesh with custom shaders are not supported in CanvasRenderer."))},i.Mesh.prototype._canvasPadding=null,Object.defineProperty(i.Mesh.prototype,"canvasPadding",{get:function(){return null!==this._canvasPadding?this._canvasPadding:a.settings.MESH_CANVAS_PADDING},set:function(e){this._canvasPadding=e}}),n.SimpleMesh.prototype._renderCanvas=function(e){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),this.shader.update&&this.shader.update(),this.calculateUvs(),this.material._renderCanvas(e,this)},n.SimpleRope.prototype._renderCanvas=function(e){(this.autoUpdate||this.geometry._width!==this.shader.texture.height)&&(this.geometry._width=this.shader.texture.height,this.geometry.update()),this.shader.update&&this.shader.update(),this.calculateUvs(),this.material._renderCanvas(e,this)},exports.CanvasMeshRenderer=s;
//# sourceMappingURL=canvas-mesh.min.js.map
