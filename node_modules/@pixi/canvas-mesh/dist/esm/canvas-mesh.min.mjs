/*!
 * @pixi/canvas-mesh - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/canvas-mesh is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */
import{ExtensionType as t,Texture as e}from"@pixi/core";import{DRAW_MODES as r}from"@pixi/constants";import{canvasUtils as a}from"@pixi/canvas-renderer";import{settings as i}from"@pixi/settings";import{MeshMaterial as n,Mesh as s}from"@pixi/mesh";import{NineSlicePlane as o,SimpleMesh as h,SimpleRope as d}from"@pixi/mesh-extras";var l=function(){function i(t){this.renderer=t}return i.prototype.render=function(t){var e=this.renderer,a=t.worldTransform;e.context.globalAlpha=t.worldAlpha,e.setBlendMode(t.blendMode),e.setContextTransform(a,t.roundPixels),t.drawMode!==r.TRIANGLES?this._renderTriangleMesh(t):this._renderTriangles(t)},i.prototype._renderTriangleMesh=function(t){for(var e=t.geometry.buffers[0].data.length,r=0;r<e-2;r++){var a=2*r;this._renderDrawTriangle(t,a,a+2,a+4)}},i.prototype._renderTriangles=function(t){for(var e=t.geometry.getIndex().data,r=e.length,a=0;a<r;a+=3){var i=2*e[a],n=2*e[a+1],s=2*e[a+2];this._renderDrawTriangle(t,i,n,s)}},i.prototype._renderDrawTriangle=function(t,r,i,n){var s=this.renderer.context,o=t.geometry.buffers[0].data,h=t.uvs,d=t.texture;if(d.valid){var l=16777215!==t.tint,p=d.baseTexture,c=p.width,v=p.height;l&&t._cachedTint!==t.tint&&(t._cachedTint=t.tint,t._cachedTexture=t._cachedTexture||new e(p),t._tintedCanvas=a.getTintedCanvas({texture:t._cachedTexture},t.tint));var u=l?t._tintedCanvas:p.getDrawableSource(),f=h[r]*p.width,g=h[i]*p.width,_=h[n]*p.width,m=h[r+1]*p.height,x=h[i+1]*p.height,T=h[n+1]*p.height,y=o[r],w=o[i],C=o[n],M=o[r+1],P=o[i+1],b=o[n+1],A=t.canvasPadding/this.renderer.resolution;if(A>0){var D=t.worldTransform,U=D.a,S=D.b,I=D.c,B=D.d,N=(y+w+C)/3,H=(M+P+b)/3,V=y-N,q=M-H,E=U*V+I*q,F=S*V+B*q,G=Math.sqrt(E*E+F*F),R=1+A/G;y=N+V*R,M=H+q*R,E=U*(V=w-N)+I*(q=P-H),F=S*V+B*q,w=N+V*(R=1+A/(G=Math.sqrt(E*E+F*F))),P=H+q*R,E=U*(V=C-N)+I*(q=b-H),F=S*V+B*q,C=N+V*(R=1+A/(G=Math.sqrt(E*E+F*F))),b=H+q*R}s.save(),s.beginPath(),s.moveTo(y,M),s.lineTo(w,P),s.lineTo(C,b),s.closePath(),s.clip();var W=f*x+m*_+g*T-x*_-m*g-f*T,j=y*x+m*C+w*T-x*C-m*w-y*T,L=f*w+y*_+g*C-w*_-y*g-f*C,O=f*x*C+m*w*_+y*g*T-y*x*_-m*g*C-f*w*T,k=M*x+m*b+P*T-x*b-m*P-M*T,z=f*P+M*_+g*b-P*_-M*g-f*b,J=f*x*b+m*P*_+M*g*T-M*x*_-m*g*b-f*P*T;s.transform(j/W,k/W,L/W,z/W,O/W,J/W),s.drawImage(u,0,0,c*p.resolution,v*p.resolution,0,0,c,v),s.restore(),this.renderer.invalidateBlendMode()}},i.prototype.renderMeshFlat=function(t){var e=this.renderer.context,r=t.geometry.getBuffer("aVertexPosition").data,a=r.length/2;e.beginPath();for(var i=1;i<a-2;++i){var n=2*i,s=r[n],o=r[n+1],h=r[n+2],d=r[n+3],l=r[n+4],p=r[n+5];e.moveTo(s,o),e.lineTo(h,d),e.lineTo(l,p)}e.fillStyle="#FF0000",e.fill(),e.closePath()},i.prototype.destroy=function(){this.renderer=null},i.extension={name:"mesh",type:t.CanvasRendererPlugin},i}();i.MESH_CANVAS_PADDING=0,n.prototype._renderCanvas=function(t,e){t.plugins.mesh.render(e)},o.prototype._cachedTint=16777215,o.prototype._tintedCanvas=null,o.prototype._canvasUvs=null,o.prototype._renderCanvas=function(t){var e=t.context,r=this.worldTransform,i=16777215!==this.tint,n=this.texture;if(n.valid){i&&this._cachedTint!==this.tint&&(this._cachedTint=this.tint,this._tintedCanvas=a.getTintedCanvas(this,this.tint));var s=i?this._tintedCanvas:n.baseTexture.getDrawableSource();this._canvasUvs||(this._canvasUvs=[0,0,0,0,0,0,0,0]);var o=this.vertices,h=this._canvasUvs,d=i?0:n.frame.x,l=i?0:n.frame.y,p=d+n.frame.width,c=l+n.frame.height;h[0]=d,h[1]=d+this._leftWidth,h[2]=p-this._rightWidth,h[3]=p,h[4]=l,h[5]=l+this._topHeight,h[6]=c-this._bottomHeight,h[7]=c;for(var v=0;v<8;v++)h[v]*=n.baseTexture.resolution;e.globalAlpha=this.worldAlpha,t.setBlendMode(this.blendMode),t.setContextTransform(r,this.roundPixels);for(var u=0;u<3;u++)for(var f=0;f<3;f++){var g=2*f+8*u,_=Math.max(1,h[f+1]-h[f]),m=Math.max(1,h[u+5]-h[u+4]),x=Math.max(1,o[g+10]-o[g]),T=Math.max(1,o[g+11]-o[g+1]);e.drawImage(s,h[f],h[u+4],_,m,o[g],o[g+1],x,T)}}};var p=!1;s.prototype._cachedTint=16777215,s.prototype._tintedCanvas=null,s.prototype._cachedTexture=null,s.prototype._renderCanvas=function(t){this.shader.uvMatrix&&(this.shader.uvMatrix.update(),this.calculateUvs()),this.material._renderCanvas?this.material._renderCanvas(t,this):p||(p=!0,globalThis.console&&console.warn("Mesh with custom shaders are not supported in CanvasRenderer."))},s.prototype._canvasPadding=null,Object.defineProperty(s.prototype,"canvasPadding",{get:function(){return null!==this._canvasPadding?this._canvasPadding:i.MESH_CANVAS_PADDING},set:function(t){this._canvasPadding=t}}),h.prototype._renderCanvas=function(t){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),this.shader.update&&this.shader.update(),this.calculateUvs(),this.material._renderCanvas(t,this)},d.prototype._renderCanvas=function(t){(this.autoUpdate||this.geometry._width!==this.shader.texture.height)&&(this.geometry._width=this.shader.texture.height,this.geometry.update()),this.shader.update&&this.shader.update(),this.calculateUvs(),this.material._renderCanvas(t,this)};export{l as CanvasMeshRenderer};
//# sourceMappingURL=canvas-mesh.min.mjs.map
